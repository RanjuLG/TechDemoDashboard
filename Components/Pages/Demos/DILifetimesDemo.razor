@page "/demos/di-lifetimes"
@using TechDemoDashboard.Services
@inject TransientService Transient1
@inject TransientService Transient2
@inject ScopedService Scoped1
@inject ScopedService Scoped2
@inject SingletonService Singleton1
@inject SingletonService Singleton2
@rendermode InteractiveServer

<PageTitle>DI Lifetimes Demo</PageTitle>

<div class="min-vh-100 bg-dark-custom p-4">
    <div class="container-fluid" style="max-width: 1200px;">
        <!-- Header -->
        <div class="mb-4">
            <h1 class="h2 fw-bold text-primary-custom mb-2">
                <span class="me-2">üíâ</span>DI Lifetimes Visualizer
            </h1>
            <p class="text-secondary-custom">
                Understand the difference between Transient, Scoped, and Singleton service lifetimes.
                Each service generates a unique GUID when instantiated. Watch how they behave differently!
            </p>
        </div>

        <!-- Interview Question -->
        <div class="alert alert-info border-info mb-4">
            <span class="fw-bold">üéØ Interview Question:</span>
            <span class="fst-italic">"What is the difference between Scoped and Transient services?"</span>
        </div>

        <!-- Controls -->
        <div class="mb-4">
            <button class="btn btn-primary" @onclick="RefreshPage">
                <span class="me-1">üîÑ</span> Refresh Page
            </button>
            <span class="ms-3 text-secondary-custom small">Click to see how each lifetime behaves on refresh</span>
        </div>

        <!-- Lifetime Cards -->
        <div class="row g-4 mb-4">
            <!-- Transient -->
            <div class="col-lg-4">
                <div class="card h-100 border-danger">
                    <div class="card-header bg-danger bg-opacity-10 border-bottom border-danger">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-2">
                                <span class="fs-4">üîÑ</span>
                                <h3 class="h5 mb-0 text-danger">Transient</h3>
                            </div>
                            <span class="badge bg-danger bg-opacity-25 text-danger">New instance every time</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="text-secondary-custom small mb-3">
                            A new instance is created <strong class="text-white">every time</strong> the service is requested.
                        </p>
                        <div class="mb-3">
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <span class="small text-muted" style="min-width: 80px;">Injection 1:</span>
                                <code class="flex-grow-1 bg-dark p-2 rounded text-primary-custom small">@Transient1.InstanceId.ToString()[..8]...</code>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <span class="small text-muted" style="min-width: 80px;">Injection 2:</span>
                                <code class="flex-grow-1 bg-dark p-2 rounded text-primary-custom small">@Transient2.InstanceId.ToString()[..8]...</code>
                            </div>
                        </div>
                        <div class="alert @(Transient1.InstanceId == Transient2.InstanceId ? "alert-success" : "alert-danger") py-2 mb-0 text-center">
                            @if (Transient1.InstanceId == Transient2.InstanceId)
                            {
                                <span>‚úÖ Same instance</span>
                            }
                            else
                            {
                                <span>‚ùå Different instances</span>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scoped -->
            <div class="col-lg-4">
                <div class="card h-100 border-info">
                    <div class="card-header bg-info bg-opacity-10 border-bottom border-info">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-2">
                                <span class="fs-4">üì¶</span>
                                <h3 class="h5 mb-0 text-info">Scoped</h3>
                            </div>
                            <span class="badge bg-info bg-opacity-25 text-info">One per request</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="text-secondary-custom small mb-3">
                            One instance per <strong class="text-white">HTTP request/scope</strong>. Same within request, different across requests.
                        </p>
                        <div class="mb-3">
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <span class="small text-muted" style="min-width: 80px;">Injection 1:</span>
                                <code class="flex-grow-1 bg-dark p-2 rounded text-primary-custom small">@Scoped1.InstanceId.ToString()[..8]...</code>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <span class="small text-muted" style="min-width: 80px;">Injection 2:</span>
                                <code class="flex-grow-1 bg-dark p-2 rounded text-primary-custom small">@Scoped2.InstanceId.ToString()[..8]...</code>
                            </div>
                        </div>
                        <div class="alert @(Scoped1.InstanceId == Scoped2.InstanceId ? "alert-success" : "alert-danger") py-2 mb-0 text-center">
                            @if (Scoped1.InstanceId == Scoped2.InstanceId)
                            {
                                <span>‚úÖ Same instance (within this request)</span>
                            }
                            else
                            {
                                <span>‚ùå Different instances</span>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Singleton -->
            <div class="col-lg-4">
                <div class="card h-100 border-warning">
                    <div class="card-header bg-warning bg-opacity-10 border-bottom border-warning">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-2">
                                <span class="fs-4">üåê</span>
                                <h3 class="h5 mb-0 text-warning">Singleton</h3>
                            </div>
                            <span class="badge bg-warning bg-opacity-25 text-warning">One for all</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="text-secondary-custom small mb-3">
                            One instance for the <strong class="text-white">entire application lifetime</strong>. Never changes.
                        </p>
                        <div class="mb-3">
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <span class="small text-muted" style="min-width: 80px;">Injection 1:</span>
                                <code class="flex-grow-1 bg-dark p-2 rounded text-primary-custom small">@Singleton1.InstanceId.ToString()[..8]...</code>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <span class="small text-muted" style="min-width: 80px;">Injection 2:</span>
                                <code class="flex-grow-1 bg-dark p-2 rounded text-primary-custom small">@Singleton2.InstanceId.ToString()[..8]...</code>
                            </div>
                        </div>
                        <div class="alert @(Singleton1.InstanceId == Singleton2.InstanceId ? "alert-success" : "alert-danger") py-2 mb-0 text-center">
                            @if (Singleton1.InstanceId == Singleton2.InstanceId)
                            {
                                <span>‚úÖ Same instance (always!)</span>
                            }
                            else
                            {
                                <span>‚ùå Different instances</span>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Table -->
        <div class="card">
            <div class="card-header">
                <h3 class="h6 mb-0 fw-bold">üìñ Key Takeaways</h3>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-dark table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Lifetime</th>
                                <th>Created When</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-danger">Transient</span></td>
                                <td>Every injection</td>
                                <td>Lightweight, stateless services</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info">Scoped</span></td>
                                <td>Once per request</td>
                                <td>DbContext, per-request state</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-warning text-dark">Singleton</span></td>
                                <td>Once per app</td>
                                <td>Caches, configuration, logging</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Inject]
    private NavigationManager Navigation { get; set; } = default!;

    private void RefreshPage()
    {
        Navigation.NavigateTo(Navigation.Uri, forceLoad: true);
    }
}

<style>
    .table-dark {
        --bs-table-bg: transparent;
        --bs-table-border-color: var(--border-color);
    }
    
    .table-dark th {
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
    }
    
    .table-dark td {
        color: var(--text-primary);
    }
</style>
